# Implementation Plan: Detailed Output with Description Feature

**Branch**: `003-detailed-description` | **Date**: 2026-02-01 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/003-detailed-description/spec.md`

## Summary

Enhance the `--long` (`-l`) output format to display NAME, SOURCE, and DESCRIPTION columns instead of NAME, VERSION, SOURCE, and PATH. This provides users with brief descriptions of each component for quick understanding, with automatic truncation for long descriptions.

## Technical Context

**Language/Version**: Rust 1.75
**Primary Dependencies**: `unicode-width` crate (already available via `unicode-width` dep)
**Storage**: N/A (no data persistence change)
**Testing**: `cargo test` (unit + integration tests)
**Target Platform**: macOS/Linux terminals
**Project Type**: Single CLI tool
**Performance Goals**: Negligible impact (<5ms additional rendering)
**Constraints**: Terminal output must maintain alignment; handle Unicode correctly
**Scale/Scope**: All 6 component types (plugins, skills, MCP, hooks, agents, commands)

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. 规范驱动开发 | ✅ PASS | Feature spec created with user scenarios |
| II. 测试优先 (NON-NEGOTIABLE) | ✅ PASS | Test plan included in spec |
| III. 开源协作 | ✅ PASS | Commit messages will document changes |

**Gates Evaluated**:
- ✅ All user stories have acceptance scenarios
- ✅ Requirements are testable and unambiguous
- ✅ No implementation details in specification

## Project Structure

### Documentation (this feature)

```text
specs/003-detailed-description/
├── plan.md              # This file (/speckit.plan command output)
├── research.md          # Phase 0 output (Unicode handling, truncation strategy)
├── data-model.md        # Phase 1 output (struct changes, utility types)
├── quickstart.md        # Phase 1 output (user guide)
├── contracts/           # Phase 1 output (output format specification)
│   └── detailed-output-format.md
└── tasks.md             # Phase 2 output (/speckit.tasks command - NOT created by /speckit.plan)
```

### Source Code (repository root)

```text
src/
├── lib.rs               # Module declarations
├── main.rs              # CLI entry point
├── cli.rs               # CLI args (unchanged)
├── info.rs              # Data structures (add description to PluginInfo, McpInfo, HookInfo)
├── error.rs             # Error types (unchanged)
├── output.rs            # Color/coloring utilities (unchanged)
├── parsers/             # Component parsers (unchanged)
└── formatters/
    ├── compact.rs       # Compact output (unchanged)
    └── detailed.rs      # Detailed output (MODIFIED - new format)

tests/
├── cli_test.rs          # Add/update integration tests
└── fixtures/            # Test data (unchanged)
```

**Structure Decision**: Single Rust project structure. Modifications limited to:
- `src/info.rs`: Add description fields to PluginInfo, McpInfo, HookInfo
- `src/formatters/detailed.rs`: Complete rewrite of output format
- `tests/cli_test.rs`: Update expected outputs for --long flag

## Phase 0: Research Complete ✅

### Research Findings (see research.md)

| Decision | Choice | Rationale |
|----------|--------|-----------|
| Truncation width | 50 characters | Standard terminal width optimization |
| Unicode handling | `unicode-width` crate | Rust standard for Unicode width |
| Placeholder | "-" | Consistent with existing empty values |
| Column widths | NAME=30, SOURCE=15, DESCRIPTION=50 | Balanced for 80-column terminal |

### Resolved Questions

- ✅ Unicode character width calculation using `unicode-width` crate
- ✅ Description placeholder for components without descriptions
- ✅ Column width configuration for standard terminals

## Phase 1: Design Complete ✅

### Data Model Changes (see data-model.md)

1. **PluginInfo**: Add `description: Option<String>` (derived from source)
2. **McpInfo**: Add `description: Option<String>` (derived from status)
3. **HookInfo**: Add `description: Option<String>` (derived from hook_type)
4. **New trait**: `DescriptionProvider` for consistent description access
5. **New struct**: `TruncationConfig` for truncation settings

### Output Format (see contracts/detailed-output-format.md)

**Before**:
```
NAME(30) VERSION(18) SOURCE(15) PATH
```

**After**:
```
NAME(30) SOURCE(15) DESCRIPTION(50)
```

### Quick Start (see quickstart.md)

User-facing documentation for the new feature ready.

## Phase 2: Implementation Planning

*To be generated by `/speckit.tasks` command*

### Expected Tasks

| Phase | Task | Description |
|-------|------|-------------|
| 1 | Modify data structures | Add description to PluginInfo, McpInfo, HookInfo |
| 2 | Add truncation utility | Create `truncate_with_ellipsis` function |
| 3 | Rewrite detailed formatter | Update `format_detailed` for new column layout |
| 4 | Add unit tests | Test truncation logic, Unicode handling |
| 5 | Update integration tests | Update expected outputs for --long flag |
| 6 | Update snapshots | Regenerate insta snapshots if used |

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| N/A | No violations | - |

## Next Steps

1. Run `/speckit.tasks` to generate implementation tasks
2. Implement tasks in order (TDD approach)
3. Run `make check` to validate
4. Commit and push changes
5. Create PR for review

## Artifacts Generated

| Artifact | Path |
|----------|------|
| Implementation Plan | `specs/003-detailed-description/plan.md` |
| Research | `specs/003-detailed-description/research.md` |
| Data Model | `specs/003-detailed-description/data-model.md` |
| Quickstart | `specs/003-detailed-description/quickstart.md` |
| Contracts | `specs/003-detailed-description/contracts/detailed-output-format.md` |
